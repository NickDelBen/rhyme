var http = require("http");
var https = require("https");

/************
* getJSON:  REST get request returning JSON object(s)
* @param options: http options object
* @param callback: callback to pass the results JSON object(s) back
************/
exports.getJSON = function(options, onResult) {
  //Find the proticol we are using to communicate
  var proticol = options.port == 443 ? https : http;
  //Handle the request
  var request = proticol.request(options, function(result) {
    var output = '';
    result.setEncoding('utf8');
    //Handle each data packet
    result.on('data', function (chunk) {
      //Append the data packet to the putput
      output += chunk;
    });
    //Once all data has been received
    result.on('end', function() {
      //Parse the received data into a json file
      var object = JSON.parse(output);
      //Execute the callback function
      onResult(result.statusCode, object);
    });
  });
  //Handle a failed request
  request.on('error', function(err) {
    process.stderr.write("There was an error communicating with the rhyme server\n");
  });
  //Terminate handling of the request
  request.end();
};